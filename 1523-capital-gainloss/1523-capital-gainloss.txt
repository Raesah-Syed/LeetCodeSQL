SELECT stock_name, sum(capital) capital_gain_loss from (
SELECT stock_name, case when operation='Buy' then -price
when operation='Sell' then price end as capital
from Stocks
)x 
group by stock_name
